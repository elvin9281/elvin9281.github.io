<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="C String #  Makfile #  CC = gcc # 定義編譯選項 CFLAGS = -Wall -Wextra -std=c11 -fPIC LDFLAGS = -shared # 定義可執行文件名和共享庫名 TARGET = myprogram TARGET_LIB = libstr_utils.so # 定義源文件 SRCS = main.c LIB_SRCS = str_utils.c # 定義目標文件 OBJS = $(SRCS:.c=.o) LIB_OBJS = $(LIB_SRCS:.c=.o) # 默認目標 all: $(TARGET_LIB) $(TARGET) # 編譯共享庫 $(TARGET_LIB): $(LIB_OBJS) $(CC) $(LDFLAGS) -o $@ $^ # 編譯可執行文件，並鏈接共享庫 $(TARGET): $(OBJS) $(CC) $(CFLAGS) -o $(TARGET) $(OBJS) -L. -lstr_utils # 編譯目標文件 %.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content>
<meta property="og:description" content="C String #  Makfile #  CC = gcc # 定義編譯選項 CFLAGS = -Wall -Wextra -std=c11 -fPIC LDFLAGS = -shared # 定義可執行文件名和共享庫名 TARGET = myprogram TARGET_LIB = libstr_utils.so # 定義源文件 SRCS = main.c LIB_SRCS = str_utils.c # 定義目標文件 OBJS = $(SRCS:.c=.o) LIB_OBJS = $(LIB_SRCS:.c=.o) # 默認目標 all: $(TARGET_LIB) $(TARGET) # 編譯共享庫 $(TARGET_LIB): $(LIB_OBJS) $(CC) $(LDFLAGS) -o $@ $^ # 編譯可執行文件，並鏈接共享庫 $(TARGET): $(OBJS) $(CC) $(CFLAGS) -o $(TARGET) $(OBJS) -L. -lstr_utils # 編譯目標文件 %.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://elvin9281.github.io/docs/notes/sideproject/c_str/"><meta property="article:section" content="docs">
<title>C Str | Garlic Notes</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.8f048761a36715f434f1e933b14fbc9f897c54554bdc4aaba8a333bfd76f79eb.js integrity="sha256-jwSHYaNnFfQ08ekzsU+8n4l8VFVL3EqrqKMzv9dvees=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>Garlic Notes</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li class=book-section-flat>
<span>Notes</span>
<ul>
<li>
<input type=checkbox id=section-1f40e6bd8584ff01b24ea755dbd5b58b class=toggle>
<label for=section-1f40e6bd8584ff01b24ea755dbd5b58b class="flex justify-between">
<a role=button>Book</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/book/gained/>Gained</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-c675a868e6c7966b8fa5245aad12a64c class=toggle>
<label for=section-c675a868e6c7966b8fa5245aad12a64c class="flex justify-between">
<a role=button>Docker</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/docker/commands/>Commands</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-930ff177a0ce1f5063e515c7a7d7c8d3 class=toggle>
<label for=section-930ff177a0ce1f5063e515c7a7d7c8d3 class="flex justify-between">
<a role=button>Linux Commands</a>
</label>
<ul>
<li>
<input type=checkbox id=section-2d3643436d929ee2b4473f55a3c127ae class=toggle>
<label for=section-2d3643436d929ee2b4473f55a3c127ae class="flex justify-between">
<a role=button>Basic</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/basic/commands/>Commands</a>
</li>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/basic/file/>File</a>
</li>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/basic/redirect/>Redirect</a>
</li>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/basic/vim/>Vim</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-0cd96428afd5daf453d4762be9533fa0 class=toggle>
<label for=section-0cd96428afd5daf453d4762be9533fa0 class="flex justify-between">
<a role=button>Iptables</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/iptables/commands/>Commands</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-08b2f77b6b79c794216470d3c71c25b8 class=toggle>
<label for=section-08b2f77b6b79c794216470d3c71c25b8 class="flex justify-between">
<a role=button>Network</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/network/brctl/>Brctl</a>
</li>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/network/curl/>Curl</a>
</li>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/network/ip/>IP</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-d9e9cc08d3187c6865e47afdd6eacd62 class=toggle>
<label for=section-d9e9cc08d3187c6865e47afdd6eacd62 class="flex justify-between">
<a role=button>Shell</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/linux_commands/shell/string/>String</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-4abbb1db4cc0f9d10402d2c2abc255b1 class=toggle checked>
<label for=section-4abbb1db4cc0f9d10402d2c2abc255b1 class="flex justify-between">
<a role=button>Side Project</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/sideproject/c_str/ class=active>C Str</a>
</li>
<li>
<a href=https://elvin9281.github.io/docs/notes/sideproject/jwt_auth/>JWT Auth</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-2886ddedf2416359de6a35051093fa78 class=toggle>
<label for=section-2886ddedf2416359de6a35051093fa78 class="flex justify-between">
<a role=button>Skills</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/skills/ssh_tunnel/>SSH Tunnel</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ffaabd74a5f082ef602371bb1a05878c class=toggle>
<label for=section-ffaabd74a5f082ef602371bb1a05878c class="flex justify-between">
<a role=button>Virtual Machine</a>
</label>
<ul>
<li>
<a href=https://elvin9281.github.io/docs/notes/virtual-machine/vagrant/>Vagrant</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<a href=/posts/>
Blog
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>C Str</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#makfile>Makfile</a></li>
<li><a href=#str_utilsc-str_utilsh>str_utils.c, str_utils.h</a></li>
<li><a href=#cell_bandh>cell_band.h</a></li>
<li><a href=#mainc>main.c</a></li>
<li><a href=#result>Result</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=c-string>
C String
<a class=anchor href=#c-string>#</a>
</h1>
<h3 id=makfile>
Makfile
<a class=anchor href=#makfile>#</a>
</h3>
<pre tabindex=0><code>CC = gcc

# 定義編譯選項
CFLAGS = -Wall -Wextra -std=c11 -fPIC
LDFLAGS = -shared

# 定義可執行文件名和共享庫名
TARGET = myprogram
TARGET_LIB = libstr_utils.so

# 定義源文件
SRCS = main.c
LIB_SRCS = str_utils.c

# 定義目標文件
OBJS = $(SRCS:.c=.o)
LIB_OBJS = $(LIB_SRCS:.c=.o)

# 默認目標
all: $(TARGET_LIB) $(TARGET)

# 編譯共享庫
$(TARGET_LIB): $(LIB_OBJS)
	$(CC) $(LDFLAGS) -o $@ $^

# 編譯可執行文件，並鏈接共享庫
$(TARGET): $(OBJS)
	$(CC) $(CFLAGS) -o $(TARGET) $(OBJS) -L. -lstr_utils

# 編譯目標文件
%.o: %.c
	$(CC) $(CFLAGS) -c $&lt; -o $@

# 安裝共享庫到 /usr/lib 並更新共享庫緩存
install: $(TARGET_LIB)
	sudo cp $(TARGET_LIB) /usr/lib/
	sudo ldconfig

# 清理生成的文件
clean:
	rm -f $(TARGET) $(OBJS) $(LIB_OBJS) $(TARGET_LIB)

# 伺服器測試生成 Makefile
.PHONY: all clean install
</code></pre><h3 id=str_utilsc-str_utilsh>
str_utils.c, str_utils.h
<a class=anchor href=#str_utilsc-str_utilsh>#</a>
</h3>
<pre tabindex=0><code># .h
#ifndef STR_UTILS_H
#define STR_UTILS_H

// 函数声明
char* create_str(const char* src);
void delete_str(char* ptr);

#endif // STR_UTILS_H

# .c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

// 函数声明
char* create_str(const char* src);
void delete_str(char* ptr);

// 分配内存并复制字符串
char* create_str(const char* src) {
    size_t length = strlen(src) + 1;
    char* buffer = (char*)malloc(length);
    if (buffer == NULL) {
        perror(&quot;Unable to allocate memory&quot;);
        return NULL;
    }
    strncpy(buffer, src, length);
    buffer[length - 1] = '\0'; // 确保字符串终止
    return buffer;
}

// 释放内存
void delete_str(char* ptr) {
    free(ptr);
}
</code></pre><h3 id=cell_bandh>
cell_band.h
<a class=anchor href=#cell_bandh>#</a>
</h3>
<pre tabindex=0><code>typedef struct wcdmaBandCombination {
    char* beband_map;   // combo to bitmap
    char* afband_map;   // combo to bitmap
} wcdmaBandCombo;

const wcdmaBandCombo WCDMA_BITMAP[] = {
    // beband       afband
    { &quot;100000000&quot;, &quot;11111011&quot;},
};

#define WCDMA_BITMAP_COUNT (sizeof(WCDMA_BITMAP)/sizeof(wcdmaBandCombo))
#define TEST_WCDMA_BAND &quot;100000000&quot;
</code></pre><h3 id=mainc>
main.c
<a class=anchor href=#mainc>#</a>
</h3>
<pre tabindex=0><code>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &quot;cell_band.h&quot;
#include &quot;str_utils.h&quot;

// 長度: 
char myString[15+1] = &quot;Original String&quot;;

// 函數定義，接受一個字符數組作為參數
void modifyString(char* buf, char* str, size_t bufSize) {
    // 確保字串不會超過指定大小
    printf(&quot;bufSize: %d\n&quot;, (int)(bufSize));
    strncpy(buf, str, bufSize - 1);
    buf[bufSize - 1] = '\0'; // 保證字串以空字符結束
}

void changeCharString(char* str) {
    int len = strlen(str);
    for (int i = 1; i &lt;= 7 &amp;&amp; i &lt; len; i++) {
        str[i] = '0';
    }
}

// strlen(&quot;100000000&quot;) == 9
void changeBand(char* str) {
    printf(&quot;strlen(str): %d\n&quot;, (int)strlen(str));
    int i, end;
    int count = (int)WCDMA_BITMAP_COUNT;
    for (i = 0; i &lt; count; i++) {
        if (strncmp(WCDMA_BITMAP[i].beband_map, str, strlen(str)) == 0) {
        	strncpy(str,WCDMA_BITMAP[i].afband_map, strlen(str));
		end = (int)strlen(str)+1;
        	str[end] = '\0'; // 保證字串以空字符結束
                printf(&quot;new str : %s\n&quot;, str);
		break;
        }
    }
}

int main() {

    printf(&quot;Before: %s\n&quot;, myString);

    char test[30]={0};
    // 調用函數並傳遞字符數組
    modifyString(test, myString, sizeof(test));
    printf(&quot;test: %s\n&quot;, test);

    changeCharString(test);
    printf(&quot;After test: %s\n&quot;, test);

    // Static
    char testBandSt[9+1] = TEST_WCDMA_BAND;
    changeBand(testBandSt);
    // Dynamic
    //char* testBandDy = (char*)malloc(strlen(TEST_WCDMA_BAND)+1);
    //strcpy(testBandDy, TEST_WCDMA_BAND);
    char* testBandDy = create_str(TEST_WCDMA_BAND);
    changeBand(testBandDy);
    delete_str(testBandDy);
    //free(testBandDy);

    return 0;
}
</code></pre><h3 id=result>
Result
<a class=anchor href=#result>#</a>
</h3>
<pre tabindex=0><code>$ make
gcc -Wall -Wextra -std=c11 -fPIC -c str_utils.c -o str_utils.o
gcc -shared -o libstr_utils.so str_utils.o
gcc -Wall -Wextra -std=c11 -fPIC -c main.c -o main.o
gcc -Wall -Wextra -std=c11 -fPIC -o myprogram main.o -L. -lstr_utils

$ ls -als /usr/lib/libstr*
12 -rwxr-xr-x 1 root root 8432 Jul 28 02:50 /usr/lib/libstr_utils.so

$ ./myprogram
Before: Original String
bufSize: 30
test: Original String
After test: O0000000 String
strlen(str): 9
new str : 11111011
strlen(str): 9
new str : 11111011
</code></pre></article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#makfile>Makfile</a></li>
<li><a href=#str_utilsc-str_utilsh>str_utils.c, str_utils.h</a></li>
<li><a href=#cell_bandh>cell_band.h</a></li>
<li><a href=#mainc>main.c</a></li>
<li><a href=#result>Result</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>